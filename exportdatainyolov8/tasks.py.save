# LabelCarftProjectSetup/tasks.py

from celery import shared_task
from django.core.files.storage import default_storage
from LabelCarftProjectSetup.models import Material, Toxicity, Condition, Grade, WasteType
from storeCategoryData.models import CategoryImage, ImageLabel
from pathlib import Path
import requests
import os
from PIL import Image
import random
import yaml
import zipfile
import cv2
import numpy as np
import logging

# Configure the logger
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)

def resize_with_padding(image, target_size=(640, 640), padding_color=(0, 0, 0)):
    if not isinstance(image, np.ndarray):
        image = np.array(image)

    # Original dimensions
    h, w = image.shape[:2]
    target_w, target_h = target_size

    # Calculate the scaling factor and new dimensions
    scale = min(target_w / w, target_h / h)
    new_w = int(w * scale)
    new_h = int(h * scale)

    # Resize the image with the calculated new dimensions
    resized_image = cv2.resize(image, (new_w, new_h), interpolation=cv2.INTER_AREA)

    # Calculate padding to reach the target dimensions
    delta_w = target_w - new_w
    delta_h = target_h - new_h
    top, bottom = delta_h // 2, delta_h - (delta_h // 2)
    left, right = delta_w // 2, delta_w - (delta_w // 2)

    # Add padding
    padded_image = cv2.copyMakeBorder(resized_image, top, bottom, left, right, cv2.BORDER_CONSTANT, value=padding_color)

    return padded_image


